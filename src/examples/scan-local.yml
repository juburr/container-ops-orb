description: |
  Build and scan a container image for vulnerabilities before publishing.
  This workflow scans the local image from the build job's archive.

usage:
  version: "2.1"

  orbs:
    container-ops-orb: juburr/container-ops-orb@0.1.0

  workflows:
    build-scan-publish:
      jobs:
        - container-ops-orb/build:
            image: myapp
        - container-ops-orb/scan:
            requires:
              - container-ops-orb/build
            image: myapp
            scan_source: local
            fail_on: high
        - container-ops-orb/publish:
            requires:
              - container-ops-orb/scan
            image: myapp
            registry: ghcr.io
            registry_namespace: myorg
            context:
              - docker-credentials
